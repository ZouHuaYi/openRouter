# 新功能快速测试指南

## 🚀 启动步骤

### 1. 重新构建并启动应用

关闭当前运行的应用，然后执行：

```bash
npm run ui
```

等待构建完成，Electron 应用会自动启动。

---

## ✅ 测试清单

### 测试 1：刷新状态按钮（30 秒）

**目标**：验证刷新按钮能正常工作

1. 进入"模型列表"标签页
2. 观察右上角是否有"🔄 刷新状态"按钮
3. 点击按钮
4. ✅ 应该看到"已刷新"的提示消息

---

### 测试 2：编辑对话框中的限流设置（1 分钟）

**目标**：验证限流设置已集成到编辑对话框

1. 点击任意后端的"编辑"按钮
2. ✅ 应该看到"限流设置"分隔线
3. ✅ 下方有"启用限流"开关
4. 点击取消关闭对话框

---

### 测试 3：预设模式限流（2 分钟）

**目标**：测试天/周/月预设限流

1. 点击任意后端的"编辑"按钮
2. 开启"启用限流"开关
3. 选择"限流类型" = **预设（0点解封）**
4. "预设时长" 选择"1 天（0点解封）"
5. 点击"确定"
6. ✅ 状态列应该显示"限流至 XX"（明天 0 点）
7. ✅ "快速操作"列应该显示"立即解封"按钮

**预期时间**：
- 当前时间：2026-02-06 任意时刻
- 解封时间：2026-02-07 00:00（北京时间）

---

### 测试 4：按小时限流（2 分钟）

**目标**：测试自定义小时数 + 3 分钟延后

1. 点击另一个后端的"编辑"按钮
2. 开启"启用限流"
3. 选择"限流类型" = **按小时（+3分钟）**
4. 设置"小时数" = **2**
5. 点击"确定"
6. ✅ 状态列应该显示"限流至 XX"

**预期时间计算**：
- 假设当前时间：15:30
- 2 小时 + 3 分钟 = 17:33
- 解封时间应该是：今天 17:33 或明天对应时间

**验证方法**：
- 打开 `config/backend-state.json`
- 查看对应后端的 `unblockAt` 时间戳
- 计算是否约等于当前时间 + 2小时3分钟

---

### 测试 5：按天数限流（2 分钟）

**目标**：测试精确天数计算

1. 点击第三个后端的"编辑"按钮
2. 开启"启用限流"
3. 选择"限流类型" = **按天数**
4. 设置"天数" = **3**
5. 点击"确定"
6. ✅ 状态列应该显示"限流至 XX"

**预期时间计算**：
- 假设当前时间：2026-02-06 15:30:45
- 3 天后 = 2026-02-09 15:30:45
- 解封时间应该是：3 天后的相同时刻

---

### 测试 6：快速解封（1 分钟）

**目标**：测试表格中的快速解封按钮

1. 找到一个已限流的后端
2. 点击"快速操作"列的"立即解封"按钮
3. ✅ 应该看到"已解封"提示
4. ✅ 状态列变为"可用"
5. ✅ "快速操作"列显示"无限流"

---

### 测试 7：编辑对话框中关闭限流（1 分钟）

**目标**：测试通过对话框解除限流

1. 点击一个已限流的后端的"编辑"按钮
2. ✅ "启用限流"开关应该是开启状态
3. 关闭"启用限流"开关
4. 点击"确定"
5. ✅ 状态列变为"可用"

---

### 测试 8：持久化验证（2 分钟）

**目标**：验证限流设置重启后保持

1. 设置 2-3 个后端的不同限流模式
2. 记录各个后端的解封时间
3. **关闭 Electron 应用**
4. **重新运行 `npm run ui`**
5. 进入"模型列表"标签页
6. ✅ 所有限流状态应该保持不变
7. ✅ 解封时间应该与之前一致

---

### 测试 9：编辑模式下字段禁用（1 分钟）

**目标**：验证编辑时服务商和模型不可修改

1. 点击任意后端的"编辑"按钮
2. ✅ "服务商"下拉框应该是灰色禁用状态
3. ✅ "模型"输入框应该是灰色禁用状态
4. ✅ 限流设置部分应该可以正常修改

---

### 测试 10：提示信息验证（1 分钟）

**目标**：验证不同模式的提示信息

1. 编辑任意后端，开启限流
2. 选择"预设"模式：
   - ✅ 应该看到蓝色提示：预设模式按北京时间 00:00 解封
3. 选择"按小时"模式：
   - ✅ 应该看到黄色警告：小时模式自动延后 3 分钟
4. 选择"按天数"模式：
   - ✅ 应该看到蓝色提示：天数模式从当前时刻精确计算

---

## 🔍 详细验证

### 验证限流时间计算

打开 `config/backend-state.json`：

```bash
type config\backend-state.json
```

**应该看到类似**：
```json
{
  "doubao:model1": {
    "unblockAt": "2026-02-07T00:00:00.000Z"
  },
  "doubao:model2": {
    "unblockAt": "2026-02-06T09:33:00.000Z"
  },
  "doubao:model3": {
    "unblockAt": "2026-02-09T07:30:45.000Z"
  }
}
```

**手动验证时间**：
1. 复制 ISO 时间戳（如 `2026-02-07T00:00:00.000Z`）
2. 在浏览器控制台执行：`new Date('2026-02-07T00:00:00.000Z').toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' })`
3. 检查转换后的北京时间是否符合预期

---

## 📊 功能对比

| 功能 | 旧版本 | 新版本 |
|------|--------|--------|
| 限流设置位置 | 表格下拉菜单 | 编辑对话框 |
| 限流模式 | 仅 3 个预设 | 3 种模式 + 自定义 |
| 小时限流 | ❌ 不支持 | ✅ 支持 + 3分钟延后 |
| 自定义天数 | ❌ 不支持 | ✅ 支持 |
| 刷新状态 | ❌ 无按钮 | ✅ 右上角按钮 |
| 快速解封 | 下拉菜单 | 独立按钮 |
| 编辑限流 | ❌ 不支持 | ✅ 完全支持 |
| 提示信息 | 顶部一条 | 每种模式独立提示 |

---

## 🐛 常见问题

### 问题 1：看不到刷新按钮

**原因**：构建未完成或缓存问题

**解决**：
```bash
# 清理并重新构建
npm run ui
```

### 问题 2：编辑对话框中没有限流设置

**原因**：浏览器缓存了旧版本

**解决**：
1. 在 Electron 应用中按 `Ctrl+Shift+I` 打开开发者工具
2. 右键刷新按钮，选择"清空缓存并硬性重新加载"
3. 或者完全关闭应用重新打开

### 问题 3：限流时间不对

**检查项**：
1. 确认选择的模式
2. 查看 `config/backend-state.json` 中的实际时间戳
3. 使用浏览器控制台转换为北京时间验证

### 问题 4：点击按钮无反应

**检查项**：
1. 打开开发者工具（`Ctrl+Shift+I`）
2. 查看 Console 是否有错误
3. 检查 Network 标签是否有请求失败

---

## 📸 界面截图参考

### 新增的刷新按钮
```
┌─────────────────────────────────────────┐
│ 限流规则：                    🔄 刷新状态 │
│ • 预设模式（天/周/月）：...              │
│ • 小时模式：...                          │
│ • 天数模式：...                          │
└─────────────────────────────────────────┘
```

### 编辑对话框新布局
```
┌─────────────────────────────────┐
│ 编辑后端                        │
├─────────────────────────────────┤
│ 服务商: [doubao ▼] (禁用)      │
│ 模型:   [model-xxx] (禁用)     │
│                                 │
│ ══════ 限流设置 ═══════         │
│                                 │
│ 启用限流: [●───] 开             │
│                                 │
│ 限流类型:                       │
│   ⦿ 预设（0点解封）             │
│   ○ 按小时（+3分钟）            │
│   ○ 按天数                      │
│                                 │
│ 预设时长: [1 天（0点解封）▼]   │
│                                 │
│ [i] 预设模式按北京时间 00:00... │
│                                 │
├─────────────────────────────────┤
│              [取消]  [确定]     │
└─────────────────────────────────┘
```

---

## ✅ 验收标准

所有以下功能都应该正常工作：

- ✅ 刷新状态按钮可点击，显示"已刷新"提示
- ✅ 编辑对话框有完整的限流设置部分
- ✅ 预设模式（天/周/月）正确计算到北京时间 0 点
- ✅ 按小时模式自动加 3 分钟延后
- ✅ 按天数模式精确计算
- ✅ 快速解封按钮正常工作
- ✅ 编辑对话框中可以开启/关闭限流
- ✅ 所有设置重启后保持不变
- ✅ 编辑模式下服务商和模型不可修改
- ✅ 每种模式都有对应的提示信息

---

## 🎉 测试完成

如果所有测试都通过，恭喜！新功能已经完全可用。

现在你可以：
1. 灵活管理后端限流
2. 快速刷新状态解决 UI 不同步问题
3. 使用三种模式覆盖所有限流场景
4. 享受更完善的管理体验

**遇到问题？** 查看 `COOLDOWN_FEATURES.md` 了解详细说明。
